(()=>{let e={isConnected:!1,roomId:null,userId:null,hasLocalStream:!1};const t=document.getElementById("status"),n=document.getElementById("status-text"),o=document.getElementById("controls-section"),s=document.getElementById("party-info"),d=document.getElementById("stats-section"),i=document.getElementById("video-section"),r=document.getElementById("start-btn"),c=document.getElementById("stop-btn"),l=document.getElementById("reset-btn"),a=document.getElementById("room-input"),m=document.getElementById("room-display"),u=document.getElementById("user-display"),y=document.getElementById("local-time"),g=document.getElementById("sync-status"),p=document.getElementById("remote-users-list"),v=document.getElementById("local-video"),f=document.getElementById("remote-video"),h=document.getElementById("copy-room-btn");function I(){chrome.runtime.sendMessage({type:"GET_STATUS"},a=>{chrome.runtime.lastError||a&&(e=a,function(){const{isConnected:a,roomId:y,userId:g}=e;a?(t.className="status connected",n.textContent="üü¢ Connected",o.classList.remove("hidden"),r.classList.add("hidden"),c.classList.remove("hidden"),l.classList.remove("hidden"),s.classList.remove("hidden"),d.classList.remove("hidden"),m.textContent=y,u.textContent=g,E()):(t.className="status disconnected",n.textContent="üî¥ Disconnected",o.classList.remove("hidden"),r.classList.remove("hidden"),c.classList.add("hidden"),l.classList.add("hidden"),s.classList.add("hidden"),d.classList.add("hidden"),i.classList.add("hidden"),v.srcObject=null,f.srcObject=null)}())})}async function E(){if(e.isConnected&&e.roomId)try{const t=await fetch("http://watch.toper.dev/status");if(!t.ok)return void console.error("[Popup] Failed to fetch server status");const n=await t.json();console.log("[Popup] Server status:",n);const o=n.rooms?.find(t=>t.roomId===e.roomId);if(!o)return console.log("[Popup] Room not found on server"),void(g&&(g.textContent="Not Found",g.style.color="#ef4444"));const s=e=>{if(!e&&0!==e)return"--:--";const t=Math.floor(e);return`${Math.floor(t/60)}:${(t%60).toString().padStart(2,"0")}`};if(y&&(y.textContent=s(o.currentTime)),g){const e=o.isPlaying?"Playing":"Paused";g.textContent=e,g.style.color=o.isPlaying?"#4ade80":"#fbbf24"}if(p){const e=o.users||[];if(0===e.length)p.innerHTML='<div style="color: rgba(255,255,255,0.5); font-size: 12px; font-style: italic;">No users in party</div>';else{const t=e.map((e,t)=>{const n=Math.abs(e.currentTime-o.currentTime),d=n>2,i=e.isPlaying?"#4ade80":"#fbbf24",r=d?"#ef4444":"#4ade80";return`\n            <div style="padding: 8px; border-top: 1px solid rgba(255,255,255,0.1); ${0===t?"border-top: none;":""}">\n              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">\n                <div style="font-weight: 600; font-size: 12px; color: rgba(255,255,255,0.9);">\n                  ${e.userId.substring(0,8)}...\n                </div>\n                <div style="font-size: 10px; color: ${i};">\n                  ${e.isPlaying?"‚ñ∂":"‚è∏"}\n                </div>\n              </div>\n              <div style="display: flex; justify-content: space-between; align-items: center;">\n                <div style="font-size: 13px; font-weight: 600; color: #a78bfa;">\n                  ${s(e.currentTime)}\n                </div>\n                <div style="font-size: 10px; color: ${r}; font-weight: 600;">\n                  ${d?`¬±${n.toFixed(1)}s`:"‚úì synced"}\n                </div>\n              </div>\n            </div>\n          `}).join("");p.innerHTML=`\n          <div style="font-weight: 600; font-size: 12px; margin-bottom: 8px; color: rgba(255,255,255,0.7);">\n            ${e.length} user${1===e.length?"":"s"} in party\n          </div>\n          ${t}\n        `}}}catch(e){console.error("[Popup] Error fetching stats:",e)}else console.log("[Popup] Not connected or no room ID")}I(),r.addEventListener("click",async function(){const e=a.value.trim()||void 0;r.disabled=!0,n.textContent="‚è≥ Connecting...",chrome.runtime.sendMessage({type:"START_PARTY",roomId:e},e=>{e.success?setTimeout(I,500):(alert("Error: "+e.error),n.textContent="üî¥ Disconnected",r.disabled=!1)})}),c.addEventListener("click",function(){chrome.runtime.sendMessage({type:"STOP_PARTY"},()=>{a.value="",I()})}),l.addEventListener("click",function(){const t=a.value.trim()||e.roomId||void 0;l.disabled=!0,n.textContent="‚ôªÔ∏è Resetting...",chrome.runtime.sendMessage({type:"STOP_PARTY"},()=>{chrome.runtime.sendMessage({type:"START_PARTY",roomId:t},e=>{l.disabled=!1,e&&e.success?setTimeout(I,500):(alert("Error resetting party: "+(e&&e.error?e.error:"Unknown error")),n.textContent="üî¥ Disconnected")})})}),h.addEventListener("click",function(){e.roomId&&(navigator.clipboard.writeText(e.roomId),h.textContent="‚úì",setTimeout(()=>{h.textContent="üìã"},2e3))}),I(),setInterval(I,2e3),setInterval(()=>{e.isConnected&&E()},1e3),chrome.runtime.onMessage.addListener(e=>{"REMOTE_STREAM_RECEIVED"===e.type&&(f.srcObject=e.stream)})})();
//# sourceMappingURL=popup.js.map