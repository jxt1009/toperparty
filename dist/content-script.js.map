{"version":3,"file":"content-script.js","mappings":"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","sources":["webpack://toperparty/./chrome-extension/src/managers/sync/lock.js","webpack://toperparty/./chrome-extension/src/managers/sync/debounce.js","webpack://toperparty/./chrome-extension/src/managers/sync/SyncManager.js","webpack://toperparty/./chrome-extension/src/services/webrtc/peerConnection.js","webpack://toperparty/./chrome-extension/src/content/main.js","webpack://toperparty/./chrome-extension/src/managers/state/StateManager.js","webpack://toperparty/./chrome-extension/src/ui/UIManager.js","webpack://toperparty/./chrome-extension/src/content/netflix/NetflixController.js","webpack://toperparty/./chrome-extension/src/managers/sync/remoteHandlers.js","webpack://toperparty/./chrome-extension/src/managers/sync/eventListeners.js","webpack://toperparty/./chrome-extension/src/services/webrtc/WebRTCManager.js","webpack://toperparty/./chrome-extension/src/services/webrtc/ui.js","webpack://toperparty/./chrome-extension/src/services/webrtc/reconnect.js","webpack://toperparty/./chrome-extension/src/services/webrtc/signaling.js","webpack://toperparty/./chrome-extension/src/managers/url/URLSync.js"],"sourcesContent":["export class SyncLock {\n  constructor() {\n    this.suppressLocalUntil = 0;\n  }\n  set(durationMs) {\n    this.suppressLocalUntil = Date.now() + durationMs;\n  }\n  isActive() {\n    return Date.now() < this.suppressLocalUntil;\n  }\n}\n","export class EventDebouncer {\n  constructor(delayMs = 200) {\n    this.delayMs = delayMs;\n    this.timer = null;\n    this.events = new Set();\n  }\n  add(eventType) {\n    this.events.add(eventType);\n  }\n  schedule(fn) {\n    if (this.timer) clearTimeout(this.timer);\n    this.timer = setTimeout(() => {\n      const events = this.events;\n      this.events = new Set();\n      this.timer = null;\n      fn(events);\n    }, this.delayMs);\n  }\n  cancel() {\n    if (this.timer) clearTimeout(this.timer);\n    this.timer = null;\n    this.events.clear();\n  }\n}\n","import { SyncLock } from './lock.js';\nimport { EventDebouncer } from './debounce.js';\nimport { attachPlaybackListeners } from './eventListeners.js';\nimport { createRemoteHandlers } from './remoteHandlers.js';\n\nclass MutableRef {\n  constructor(value) { this.value = value; }\n  get() { return this.value; }\n  set(v) { this.value = v; }\n}\n\nexport class SyncManager {\n  constructor(stateManager, netflixController) {\n    this.state = stateManager;\n    this.netflix = netflixController;\n    this.lock = new SyncLock();\n    this.debouncer = new EventDebouncer(200);\n    this.isInitializedRef = new MutableRef(false);\n    this.listeners = null;\n    this.contextRef = new MutableRef({ lastUserInteractionAt: 0 });\n\n    this.remote = createRemoteHandlers({\n      state: this.state,\n      netflix: this.netflix,\n      lock: this.lock,\n      isInitializedRef: this.isInitializedRef,\n      contextRef: this.contextRef,\n    });\n  }\n\n  async setup() {\n    try {\n      const video = await this.waitForVideo();\n      if (!video) { console.warn('[SyncManager] Netflix video element not found'); return; }\n      this.isInitializedRef.set(false);\n      this.state.safeSendMessage({ type: 'REQUEST_SYNC' });\n      setTimeout(() => {\n        if (!this.isInitializedRef.get()) { this.isInitializedRef.set(true); }\n      }, 2000);\n      const listeners = attachPlaybackListeners({\n        video,\n        state: this.state,\n        isInitializedRef: this.isInitializedRef,\n        lock: this.lock,\n        debouncer: this.debouncer,\n        onBroadcast: (vid) => this.broadcastLocalState(vid),\n        onPassiveSyncContext: ({ now }) => {\n          this.state.safeSendMessage({\n            type: 'SYNC_TIME',\n            currentTime: video.currentTime,\n            isPlaying: !video.paused,\n            timestamp: now,\n          });\n        }\n      });\n      this.listeners = listeners;\n      this.contextRef.set(listeners.context);\n    } catch (err) { console.error('[SyncManager] Error setting up playback sync:', err); }\n  }\n\n  teardown() {\n    if (this.listeners && this.listeners.video) {\n      const { video, handleLocalEvent, handleTimeUpdate } = this.listeners;\n      try {\n        video.removeEventListener('play', handleLocalEvent);\n        video.removeEventListener('pause', handleLocalEvent);\n        video.removeEventListener('seeked', handleLocalEvent);\n        video.removeEventListener('timeupdate', handleTimeUpdate);\n      } catch (e) { console.warn('[SyncManager] Error removing listeners:', e); }\n      this.listeners = null;\n    }\n    this.debouncer.cancel();\n  }\n\n  waitForVideo() {\n    return new Promise((resolve, reject) => {\n      const timeout = setTimeout(() => reject(new Error('Video element timeout')), 10000);\n      const check = () => {\n        const video = this.netflix.getVideoElement();\n        if (video) { clearTimeout(timeout); resolve(video); }\n        else { setTimeout(check, 100); }\n      };\n      check();\n    });\n  }\n\n  broadcastLocalState(video) {\n    const currentTime = video.currentTime;\n    const isPlaying = !video.paused;\n    const events = new Set(this.debouncer.events);\n    // Priority: Seek > Play/Pause\n    if (events.has('seeked')) {\n      this.state.safeSendMessage({ type: 'SEEK', currentTime, isPlaying });\n    } else if (events.has('play') || events.has('pause')) {\n      const control = isPlaying ? 'play' : 'pause';\n      this.state.safeSendMessage({ type: 'PLAY_PAUSE', control, timestamp: currentTime });\n    }\n  }\n\n  // Remote API mirrors original methods\n  handleRequestSync(fromUserId) { return this.remote.handleRequestSync(fromUserId); }\n  handleSyncResponse(currentTime, isPlaying, fromUserId) { return this.remote.handleSyncResponse(currentTime, isPlaying, fromUserId); }\n  handlePlaybackControl(control, fromUserId) { return this.remote.handlePlaybackControl(control, fromUserId); }\n  handleSeek(currentTime, isPlaying, fromUserId) { return this.remote.handleSeek(currentTime, isPlaying, fromUserId); }\n  handlePassiveSync(currentTime, isPlaying, fromUserId, timestamp) { return this.remote.handlePassiveSync(currentTime, isPlaying, fromUserId, timestamp); }\n}\n","export function createPeerConnectionFactory({ stateManager, sendSignal, remoteStreams, remoteVideos, addRemoteVideo, attemptReconnection, clearReconnection, removeRemoteVideo, peersThatLeft }) {\n  return function createPeerConnection(peerId) {\n    const state = stateManager.getState();\n    const pc = new RTCPeerConnection({\n      iceServers: [\n        { urls: ['stun:stun.l.google.com:19302'] },\n        { urls: ['stun:stun1.l.google.com:19302'] }\n      ]\n    });\n    pc.onicecandidate = (event) => {\n      if (event.candidate) {\n        sendSignal({ type: 'ICE_CANDIDATE', from: state.userId, to: peerId, candidate: event.candidate });\n      }\n    };\n    pc.ontrack = (event) => {\n      let stream = (event.streams && event.streams[0]) || remoteStreams.get(peerId);\n      if (!stream) {\n        stream = new MediaStream();\n        remoteStreams.set(peerId, stream);\n      }\n      if (event.track) {\n        try { stream.addTrack(event.track); } catch (e) {}\n      }\n      if (!remoteVideos.has(peerId)) {\n        addRemoteVideo(peerId, stream);\n      }\n    };\n    pc.onconnectionstatechange = () => {\n      if (pc.connectionState === 'connected') {\n        clearReconnection(peerId);\n      } else if (pc.connectionState === 'disconnected' || pc.connectionState === 'failed') {\n        if (peersThatLeft.has(peerId)) {\n          removeRemoteVideo(peerId);\n          clearReconnection(peerId);\n        } else {\n          removeRemoteVideo(peerId);\n          attemptReconnection(peerId);\n        }\n      } else if (pc.connectionState === 'closed') {\n        removeRemoteVideo(peerId);\n        clearReconnection(peerId);\n      }\n    };\n    return pc;\n  };\n}\n\nexport function addOrReplaceTrack(pc, track, stream) {\n  const senders = pc.getSenders();\n  const existingSender = senders.find(s => s.track && s.track.kind === track.kind);\n  if (existingSender) {\n    existingSender.replaceTrack(track).catch(e => console.warn('[WebRTCManager] Error replacing track', e));\n  } else {\n    try { pc.addTrack(track, stream); } catch (e) {}\n  }\n}\n","import { StateManager } from '../managers/state/StateManager.js';\nimport { NetflixController } from './netflix/NetflixController.js';\nimport { SyncManager } from '../managers/sync/SyncManager.js';\nimport { WebRTCManager } from '../services/webrtc/WebRTCManager.js';\nimport { UIManager } from '../ui/UIManager.js';\nimport { URLSync } from '../managers/url/URLSync.js';\n\nconst stateManager = new StateManager();\nconst uiManager = new UIManager();\nconst netflixController = new NetflixController();\nconst syncManager = new SyncManager(stateManager, netflixController);\nconst webrtcManager = new WebRTCManager(stateManager, uiManager);\nconst urlSync = new URLSync(stateManager);\n\nlet localStream = null;\n\n(function checkRestorePartyState() {\n  const restorationState = urlSync.getRestorationState();\n  if (restorationState) {\n    urlSync.clearState();\n    stateManager.setRestoringFlag(true);\n    setTimeout(function() {\n      chrome.runtime.sendMessage({ type: 'RESTORE_PARTY', roomId: restorationState.roomId });\n      setTimeout(function() {\n        stateManager.setRestoringFlag(false);\n      }, 2000);\n    }, 1000);\n  }\n})();\n\nchrome.runtime.onMessage.addListener((request, sender, sendResponse) => {\n  if (request.type === 'REQUEST_MEDIA_STREAM') {\n    navigator.mediaDevices.getUserMedia({ video: true, audio: true })\n      .then(stream => {\n        localStream = stream;\n        webrtcManager.setLocalStream(stream);\n        webrtcManager.onLocalStreamAvailable(stream);\n        sendResponse({ success: true });\n      })\n      .catch(err => sendResponse({ success: false, error: err.message }));\n    return true;\n  }\n\n  if (request.type === 'PARTY_STARTED') {\n    stateManager.startParty(request.userId, request.roomId);\n    syncManager.setup();\n    urlSync.start();\n    sendResponse({ success: true });\n  }\n\n  if (request.type === 'PARTY_STOPPED') {\n    stateManager.stopParty();\n    syncManager.teardown();\n    urlSync.stop();\n    urlSync.clearState();\n    webrtcManager.clearAll();\n    if (localStream) {\n      localStream.getTracks().forEach(t => t.stop());\n      localStream = null;\n    }\n    sendResponse({ success: true });\n  }\n\n  if (request.type === 'SIGNAL') {\n    webrtcManager.handleSignal(request.message);\n  }\n\n  if (request.type === 'APPLY_PLAYBACK_CONTROL') {\n    syncManager.handlePlaybackControl(request.control, request.fromUserId);\n  }\n\n  if (request.type === 'APPLY_SYNC_PLAYBACK') {\n    syncManager.handlePassiveSync(request.currentTime, request.isPlaying, request.fromUserId, request.timestamp);\n  }\n\n  if (request.type === 'APPLY_SEEK') {\n    syncManager.handleSeek(request.currentTime, request.isPlaying, request.fromUserId);\n  }\n\n  if (request.type === 'APPLY_URL_CHANGE') {\n    if (!stateManager.restoringPartyState) {\n      window.location.href = request.url;\n    }\n  }\n\n  if (request.type === 'HANDLE_REQUEST_SYNC') {\n    syncManager.handleRequestSync(request.fromUserId);\n  }\n\n  if (request.type === 'APPLY_SYNC_RESPONSE') {\n    syncManager.handleSyncResponse(request.currentTime, request.isPlaying, request.fromUserId);\n  }\n});\n\nwindow.addEventListener('beforeunload', () => {\n  if (stateManager.isActive()) {\n    urlSync.saveState();\n  }\n});\n","export class StateManager {\n  constructor() {\n    this.partyActive = false;\n    this.userId = null;\n    this.roomId = null;\n    this.restoringPartyState = false;\n  }\n  startParty(userId, roomId) {\n    this.partyActive = true;\n    this.userId = userId;\n    this.roomId = roomId;\n  }\n  stopParty() {\n    this.partyActive = false;\n    this.userId = null;\n    this.roomId = null;\n  }\n  isActive() { return this.partyActive; }\n  getUserId() { return this.userId; }\n  getRoomId() { return this.roomId; }\n  getState() {\n    return { partyActive: this.partyActive, userId: this.userId, roomId: this.roomId, restoringPartyState: this.restoringPartyState };\n  }\n  isInParty() { return !!(this.partyActive && this.userId && this.roomId); }\n  setRestoringFlag(value) { this.restoringPartyState = value; }\n  isExtensionContextValid() {\n    try { return chrome.runtime && chrome.runtime.id; } catch { return false; }\n  }\n  safeSendMessage(message, callback) {\n    if (!this.isExtensionContextValid()) return;\n    try { chrome.runtime.sendMessage(message, callback); } catch (e) { console.warn('Failed to send message:', e.message); }\n  }\n}\n","export class UIManager {\n  constructor() {\n    this.localPreviewVideo = null;\n    this.remoteVideos = new Map();\n    this.remoteStreams = new Map();\n    this.streamMonitorInterval = null;\n  }\n  getRemoteVideos() { return this.remoteVideos; }\n  getRemoteStreams() { return this.remoteStreams; }\n  setLocalPreviewVideo(video) { this.localPreviewVideo = video; }\n  getLocalPreviewVideo() { return this.localPreviewVideo; }\n  setStreamMonitorInterval(interval) { this.streamMonitorInterval = interval; }\n  getStreamMonitorInterval() { return this.streamMonitorInterval; }\n  clearStreamMonitorInterval() {\n    if (this.streamMonitorInterval) {\n      clearInterval(this.streamMonitorInterval);\n      this.streamMonitorInterval = null;\n    }\n  }\n  clearAll() {\n    this.localPreviewVideo = null;\n    this.remoteVideos.clear();\n    this.remoteStreams.clear();\n    this.clearStreamMonitorInterval();\n  }\n}\n","export class NetflixController {\n  constructor() { this.injectAPIBridge(); }\n  injectAPIBridge() {\n    const script = document.createElement('script');\n    script.src = chrome.runtime.getURL('netflix-api-bridge.js');\n    (document.head || document.documentElement).appendChild(script);\n    script.onload = function() { script.remove(); };\n  }\n  _sendCommand(command, args = []) {\n    return new Promise(function(resolve) {\n      const handler = function(e) {\n        if (e.detail.command === command) {\n          document.removeEventListener('__toperparty_response', handler);\n          resolve(e.detail.result);\n        }\n      };\n      document.addEventListener('__toperparty_response', handler);\n      setTimeout(function() { resolve(null); }, 1000);\n      document.dispatchEvent(new CustomEvent('__toperparty_command', { detail: { command, args } }));\n    });\n  }\n  play() { return this._sendCommand('play'); }\n  pause() { return this._sendCommand('pause'); }\n  seek(timeMs) { return this._sendCommand('seek', [timeMs]); }\n  getCurrentTime() { return this._sendCommand('getCurrentTime'); }\n  isPaused() { return this._sendCommand('isPaused'); }\n  getVideoElement() { return document.querySelector('video'); }\n}\n","export function createRemoteHandlers({ state, netflix, lock, isInitializedRef, contextRef }) {\n  async function applyRemote(actionName, durationMs, actionFn) {\n    lock.set(durationMs);\n    try { await actionFn(); } catch (err) {\n      console.error(`[SyncManager] Error applying remote ${actionName}:`, err);\n    }\n  }\n\n  return {\n    async handleRequestSync(fromUserId) {\n      if (!isInitializedRef.get()) return;\n      try {\n        const currentTime = await netflix.getCurrentTime();\n        const isPaused = await netflix.isPaused();\n        state.safeSendMessage({\n          type: 'SYNC_RESPONSE',\n          targetUserId: fromUserId,\n          currentTime: currentTime / 1000,\n          isPlaying: !isPaused\n        });\n      } catch (e) { console.error('[SyncManager] Error handling sync request:', e); }\n    },\n    async handleSyncResponse(currentTime, isPlaying, fromUserId) {\n      if (isInitializedRef.get()) return;\n      isInitializedRef.set(true);\n      await applyRemote('initial-sync', 2000, async () => {\n        await netflix.seek(currentTime * 1000);\n        const localPaused = await netflix.isPaused();\n        if (isPlaying && localPaused) await netflix.play();\n        else if (!isPlaying && !localPaused) await netflix.pause();\n      });\n    },\n    async handlePlaybackControl(control) {\n      await applyRemote(control, 1000, async () => {\n        if (control === 'play') await netflix.play();\n        else await netflix.pause();\n      });\n    },\n    async handleSeek(currentTime, isPlaying) {\n      await applyRemote('seek', 2000, async () => {\n        await netflix.seek(currentTime * 1000);\n        const isPaused = await netflix.isPaused();\n        if (isPlaying && isPaused) await netflix.play();\n        else if (!isPlaying && !isPaused) await netflix.pause();\n      });\n    },\n    async handlePassiveSync(currentTime, isPlaying, fromUserId, timestamp) {\n      const now = Date.now();\n      if (timestamp && (now - timestamp > 5000)) return;\n      if (now - contextRef.get().lastUserInteractionAt < 10000) return;\n      if (lock.isActive()) return;\n      try {\n        const localTimeMs = await netflix.getCurrentTime();\n        const targetMs = currentTime * 1000;\n        const driftMs = Math.abs(localTimeMs - targetMs);\n        if (driftMs <= 3000) return;\n        await applyRemote('passive-correction', 1500, async () => {\n          await netflix.seek(targetMs);\n          const localPaused = await netflix.isPaused();\n          if (isPlaying && localPaused) await netflix.play();\n          else if (!isPlaying && !localPaused) await netflix.pause();\n        });\n      } catch (err) { console.error('[SyncManager] Error handling passive sync:', err); }\n    }\n  };\n}\n","export function attachPlaybackListeners({ video, state, isInitializedRef, lock, debouncer, onBroadcast, onPassiveSyncContext }) {\n  const context = { lastUserInteractionAt: 0 };\n  const handleLocalEvent = (e) => {\n    if (!state.isActive()) return;\n    if (!isInitializedRef.get()) return;\n    if (lock.isActive()) return;\n    context.lastUserInteractionAt = Date.now();\n    debouncer.add(e.type);\n    debouncer.schedule(() => onBroadcast(video));\n  };\n\n  let lastPassiveSentAt = 0;\n  const handleTimeUpdate = () => {\n    if (!state.isActive()) return;\n    const now = Date.now();\n    if (lock.isActive()) return;\n    if (now - context.lastUserInteractionAt < 5000) return;\n    if (now - lastPassiveSentAt < 10000) return;\n    if (video.paused) return;\n    lastPassiveSentAt = now;\n    onPassiveSyncContext({ now, lastPassiveSentAt });\n  };\n\n  video.addEventListener('play', handleLocalEvent);\n  video.addEventListener('pause', handleLocalEvent);\n  video.addEventListener('seeked', handleLocalEvent);\n  video.addEventListener('timeupdate', handleTimeUpdate);\n\n  return { video, handleLocalEvent, handleTimeUpdate, context };\n}\n","import { createSignalingHandlers } from './signaling.js';\nimport { createPeerConnectionFactory, addOrReplaceTrack } from './peerConnection.js';\nimport { createReconnectionManager } from './reconnect.js';\nimport { createRemoteVideoManager } from './ui.js';\n\nexport class WebRTCManager {\n  constructor(stateManager, uiManager) {\n    this.stateManager = stateManager;\n    this.uiManager = uiManager;\n    this.peerConnections = new Map();\n    this.remoteStreams = this.uiManager.getRemoteStreams();\n    this.remoteVideos = this.uiManager.getRemoteVideos();\n    this.peersThatLeft = new Set();\n    this.localStream = null;\n\n    const videoManager = createRemoteVideoManager(this.remoteVideos);\n    \n    const reconnectionManager = createReconnectionManager({\n      stateManager: this.stateManager,\n      peerConnections: this.peerConnections,\n      peersThatLeft: this.peersThatLeft,\n      localStream: () => this.localStream,\n      createPeer: null,\n      sendSignal: (msg) => this._sendSignal(msg),\n      addOrReplaceTrack\n    });\n\n    const createPeer = createPeerConnectionFactory({\n      stateManager: this.stateManager,\n      sendSignal: (msg) => this._sendSignal(msg),\n      remoteStreams: this.remoteStreams,\n      remoteVideos: this.remoteVideos,\n      addRemoteVideo: videoManager.add,\n      attemptReconnection: reconnectionManager.attempt,\n      clearReconnection: reconnectionManager.clear,\n      removeRemoteVideo: (peerId) => {\n        videoManager.remove(peerId);\n        this.remoteStreams.delete(peerId);\n      },\n      peersThatLeft: this.peersThatLeft\n    });\n\n    reconnectionManager.createPeer = createPeer;\n    this.reconnectionManager = reconnectionManager;\n    this.createPeer = createPeer;\n    this.videoManager = videoManager;\n\n    this.signalingHandlers = createSignalingHandlers({\n      state: this.stateManager.getState(),\n      peerConnections: this.peerConnections,\n      peersThatLeft: this.peersThatLeft,\n      localStream: () => this.localStream,\n      createPeer,\n      sendSignal: (msg) => this._sendSignal(msg),\n      addOrReplaceTrack,\n      clearReconnection: reconnectionManager.clear,\n      removeRemoteVideo: (peerId) => {\n        videoManager.remove(peerId);\n        this.remoteStreams.delete(peerId);\n      }\n    });\n  }\n\n  setLocalStream(stream) { this.localStream = stream; }\n  getLocalStream() { return this.localStream; }\n  \n  onLocalStreamAvailable(stream) {\n    this.localStream = stream;\n    this.peerConnections.forEach((pc) => {\n      try {\n        stream.getTracks().forEach(t => addOrReplaceTrack(pc, t, stream));\n      } catch (e) {}\n    });\n  }\n\n  async handleSignal(message) {\n    if (!message || !message.type) return;\n    const type = message.type;\n    const from = message.userId || message.from;\n    const to = message.to;\n    const state = this.stateManager.getState();\n    if (to && to !== state.userId) return;\n\n    if (type === 'JOIN' && from && from !== state.userId) {\n      await this.signalingHandlers.handleJoin(from);\n    } else if (type === 'OFFER' && message.offer && from && from !== state.userId) {\n      await this.signalingHandlers.handleOffer(from, message.offer);\n    } else if (type === 'ANSWER' && message.answer && from && from !== state.userId) {\n      await this.signalingHandlers.handleAnswer(from, message.answer);\n    } else if (type === 'ICE_CANDIDATE' && message.candidate && from && from !== state.userId) {\n      await this.signalingHandlers.handleIceCandidate(from, message.candidate);\n    } else if (type === 'LEAVE' && from) {\n      this.signalingHandlers.handleLeave(from);\n    }\n  }\n\n  attemptReconnection(peerId) {\n    return this.reconnectionManager.attempt(peerId);\n  }\n\n  _sendSignal(message) {\n    this.stateManager.safeSendMessage({ type: 'SIGNAL_SEND', message }, function() {});\n  }\n\n  clearAll() {\n    this.peerConnections.forEach((pc) => {\n      try { pc.close(); } catch (e) {}\n    });\n    this.peerConnections.clear();\n    this.peersThatLeft.clear();\n    this.remoteVideos.forEach((v) => {\n      try { if (v.srcObject) v.srcObject = null; } catch (e) {}\n      v.remove();\n    });\n    this.remoteVideos.clear();\n    this.remoteStreams.clear();\n    if (this.localStream) {\n      this.localStream.getTracks().forEach(track => track.stop());\n      this.localStream = null;\n    }\n  }\n}\n","export function createRemoteVideoManager(remoteVideos) {\n  function add(peerId, stream) {\n    remove(peerId);\n    const v = document.createElement('video');\n    v.id = 'toperparty-remote-' + peerId;\n    v.autoplay = true;\n    v.playsInline = true;\n    v.muted = true;\n    v.style.position = 'fixed';\n    v.style.bottom = '20px';\n    v.style.right = (20 + (remoteVideos.size * 180)) + 'px';\n    v.style.width = '240px';\n    v.style.height = '160px';\n    v.style.zIndex = 10001;\n    v.style.border = '2px solid #00aaff';\n    v.style.borderRadius = '4px';\n    try { v.srcObject = stream; } catch (e) { v.src = URL.createObjectURL(stream); }\n    document.body.appendChild(v);\n    remoteVideos.set(peerId, v);\n    try {\n      v.play().then(() => {\n        v.muted = false;\n        v.volume = 1.0;\n      }).catch(() => { v.muted = false; });\n    } catch (e) {}\n  }\n  \n  function remove(peerId) {\n    const v = remoteVideos.get(peerId);\n    if (v) {\n      try { if (v.srcObject) v.srcObject = null; } catch (e) {}\n      v.remove();\n      remoteVideos.delete(peerId);\n    }\n  }\n  \n  return { add, remove };\n}\n","export function createReconnectionManager({ stateManager, peerConnections, peersThatLeft, localStream, createPeer, sendSignal, addOrReplaceTrack }) {\n  const attempts = new Map();\n  const timeouts = new Map();\n  \n  function clear(peerId) {\n    attempts.delete(peerId);\n    const handle = timeouts.get(peerId);\n    if (handle) {\n      clearTimeout(handle);\n      timeouts.delete(peerId);\n    }\n  }\n  \n  async function attempt(peerId) {\n    if (!stateManager.isInParty()) return;\n    if (peersThatLeft.has(peerId)) {\n      clear(peerId);\n      return;\n    }\n    const count = attempts.get(peerId) || 0;\n    const maxAttempts = 5;\n    const backoffDelay = Math.min(1000 * Math.pow(2, count), 30000);\n    if (count >= maxAttempts) {\n      clear(peerId);\n      return;\n    }\n    attempts.set(peerId, count + 1);\n    const existing = timeouts.get(peerId);\n    if (existing) clearTimeout(existing);\n    const handle = setTimeout(async () => {\n      const oldPc = peerConnections.get(peerId);\n      if (oldPc) {\n        try { oldPc.close(); } catch (e) {}\n        peerConnections.delete(peerId);\n      }\n      try {\n        const pc = createPeer(peerId);\n        peerConnections.set(peerId, pc);\n        if (localStream) {\n          localStream.getTracks().forEach(t => addOrReplaceTrack(pc, t, localStream));\n        }\n        const offer = await pc.createOffer();\n        await pc.setLocalDescription(offer);\n        const state = stateManager.getState();\n        sendSignal({ type: 'OFFER', from: state.userId, to: peerId, offer: pc.localDescription });\n      } catch (err) {\n        console.error('[WebRTCManager] Reconnection failed:', err);\n        attempt(peerId);\n      }\n    }, backoffDelay);\n    timeouts.set(peerId, handle);\n  }\n  \n  return { attempt, clear };\n}\n","export function createSignalingHandlers({ state, peerConnections, peersThatLeft, localStream, createPeer, sendSignal, addOrReplaceTrack, clearReconnection, removeRemoteVideo }) {\n  return {\n    async handleJoin(from) {\n      if (from === state.userId) return;\n      peersThatLeft.delete(from);\n      if (peerConnections.has(from)) return;\n      try {\n        const pc = createPeer(from);\n        peerConnections.set(from, pc);\n        if (localStream) {\n          localStream.getTracks().forEach(t => addOrReplaceTrack(pc, t, localStream));\n        }\n        const offer = await pc.createOffer();\n        await pc.setLocalDescription(offer);\n        sendSignal({ type: 'OFFER', from: state.userId, to: from, offer: pc.localDescription });\n      } catch (err) {\n        console.error('[WebRTCManager] Error handling JOIN:', err);\n        peerConnections.delete(from);\n      }\n    },\n    async handleOffer(from, offer) {\n      if (from === state.userId) return;\n      let pc = peerConnections.get(from);\n      if (pc && pc.signalingState !== 'closed') {\n        try { pc.close(); } catch (e) {}\n        peerConnections.delete(from);\n        pc = null;\n      }\n      if (!pc) {\n        pc = createPeer(from);\n        peerConnections.set(from, pc);\n      }\n      try {\n        await pc.setRemoteDescription(new RTCSessionDescription(offer));\n        if (localStream) {\n          localStream.getTracks().forEach(t => addOrReplaceTrack(pc, t, localStream));\n        }\n        const answer = await pc.createAnswer();\n        await pc.setLocalDescription(answer);\n        sendSignal({ type: 'ANSWER', from: state.userId, to: from, answer: pc.localDescription });\n      } catch (err) {\n        console.error('[WebRTCManager] Error handling offer:', err);\n        peerConnections.delete(from);\n        try { pc.close(); } catch (e) {}\n      }\n    },\n    async handleAnswer(from, answer) {\n      const pc = peerConnections.get(from);\n      if (pc && pc.signalingState === 'have-local-offer') {\n        try {\n          await pc.setRemoteDescription(new RTCSessionDescription(answer));\n        } catch (err) {\n          console.error('[WebRTCManager] Error handling answer:', err);\n        }\n      }\n    },\n    async handleIceCandidate(from, candidate) {\n      const pc = peerConnections.get(from);\n      if (pc) {\n        try {\n          await pc.addIceCandidate(new RTCIceCandidate(candidate));\n        } catch (err) {\n          console.warn('[WebRTCManager] Error adding ICE candidate', err);\n        }\n      }\n    },\n    handleLeave(from) {\n      peersThatLeft.add(from);\n      const pc = peerConnections.get(from);\n      if (pc) {\n        try { pc.close(); } catch (e) {}\n        peerConnections.delete(from);\n      }\n      clearReconnection(from);\n      removeRemoteVideo(from);\n    }\n  };\n}\n","export class URLSync {\n  constructor(stateManager) {\n    this.stateManager = stateManager;\n    this.urlMonitorInterval = null;\n    this.lastUrl = null;\n  }\n  start() { this.lastUrl = window.location.href; }\n  stop() {\n    if (this.urlMonitorInterval) { clearInterval(this.urlMonitorInterval); this.urlMonitorInterval = null; }\n  }\n  saveState() {\n    const state = this.stateManager.getState();\n    if (!state.partyActive) return;\n    const existing = this.getRestorationState() || {};\n    const payload = {\n      roomId: state.roomId,\n      currentTime: existing.currentTime || null,\n      isPlaying: typeof existing.isPlaying === 'boolean' ? existing.isPlaying : null,\n      timestamp: Date.now()\n    };\n    sessionStorage.setItem('toperparty_restore', JSON.stringify(payload));\n  }\n  clearState() { sessionStorage.removeItem('toperparty_restore'); }\n  getRestorationState() {\n    const stored = sessionStorage.getItem('toperparty_restore');\n    if (!stored) return null;\n    try {\n      const state = JSON.parse(stored);\n      if (Date.now() - state.timestamp < 30000) { return state; }\n    } catch (e) { console.error('[toperparty] Failed to parse restoration state:', e); }\n    return null;\n  }\n}\n"],"names":["SyncLock","constructor","this","suppressLocalUntil","set","durationMs","Date","now","isActive","EventDebouncer","delayMs","timer","events","Set","add","eventType","schedule","fn","clearTimeout","setTimeout","cancel","clear","MutableRef","value","get","v","addOrReplaceTrack","pc","track","stream","existingSender","getSenders","find","s","kind","replaceTrack","catch","e","console","warn","addTrack","stateManager","partyActive","userId","roomId","restoringPartyState","startParty","stopParty","getUserId","getRoomId","getState","isInParty","setRestoringFlag","isExtensionContextValid","chrome","runtime","id","safeSendMessage","message","callback","sendMessage","uiManager","localPreviewVideo","remoteVideos","Map","remoteStreams","streamMonitorInterval","getRemoteVideos","getRemoteStreams","setLocalPreviewVideo","video","getLocalPreviewVideo","setStreamMonitorInterval","interval","getStreamMonitorInterval","clearStreamMonitorInterval","clearInterval","clearAll","netflixController","injectAPIBridge","script","document","createElement","src","getURL","head","documentElement","appendChild","onload","remove","_sendCommand","command","args","Promise","resolve","handler","detail","removeEventListener","result","addEventListener","dispatchEvent","CustomEvent","play","pause","seek","timeMs","getCurrentTime","isPaused","getVideoElement","querySelector","syncManager","state","netflix","lock","debouncer","isInitializedRef","listeners","contextRef","lastUserInteractionAt","remote","async","applyRemote","actionName","actionFn","err","error","handleRequestSync","fromUserId","currentTime","type","targetUserId","isPlaying","handleSyncResponse","localPaused","handlePlaybackControl","control","handleSeek","handlePassiveSync","timestamp","localTimeMs","targetMs","Math","abs","createRemoteHandlers","setup","waitForVideo","onBroadcast","onPassiveSyncContext","context","handleLocalEvent","lastPassiveSentAt","handleTimeUpdate","paused","attachPlaybackListeners","vid","broadcastLocalState","teardown","reject","timeout","Error","check","has","webrtcManager","peerConnections","peersThatLeft","localStream","videoManager","peerId","srcObject","delete","autoplay","playsInline","muted","style","position","bottom","right","size","width","height","zIndex","border","borderRadius","URL","createObjectURL","body","then","volume","createRemoteVideoManager","reconnectionManager","createPeer","sendSignal","attempts","timeouts","handle","attempt","count","backoffDelay","min","pow","existing","oldPc","close","getTracks","forEach","t","offer","createOffer","setLocalDescription","from","to","localDescription","createReconnectionManager","msg","_sendSignal","addRemoteVideo","attemptReconnection","clearReconnection","removeRemoteVideo","RTCPeerConnection","iceServers","urls","onicecandidate","event","candidate","ontrack","streams","MediaStream","onconnectionstatechange","connectionState","createPeerConnectionFactory","signalingHandlers","handleJoin","handleOffer","signalingState","setRemoteDescription","RTCSessionDescription","answer","createAnswer","handleAnswer","handleIceCandidate","addIceCandidate","RTCIceCandidate","handleLeave","createSignalingHandlers","setLocalStream","getLocalStream","onLocalStreamAvailable","handleSignal","stop","urlSync","urlMonitorInterval","lastUrl","start","window","location","href","saveState","getRestorationState","payload","sessionStorage","setItem","JSON","stringify","clearState","removeItem","stored","getItem","parse","restorationState","onMessage","addListener","request","sender","sendResponse","navigator","mediaDevices","getUserMedia","audio","success","url"],"ignoreList":[],"sourceRoot":""}