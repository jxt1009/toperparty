{"version":3,"file":"popup.js","mappings":"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","sources":["webpack://toperparty/./chrome-extension/src/ui/popup.main.js"],"sourcesContent":["let status = { isConnected: false, roomId: null, userId: null, hasLocalStream: false };\r\n\r\nconst statusEl = document.getElementById('status');\r\nconst statusText = document.getElementById('status-text');\r\nconst controlsSection = document.getElementById('controls-section');\r\nconst partyInfo = document.getElementById('party-info');\r\nconst statsSection = document.getElementById('stats-section');\r\nconst videoSection = document.getElementById('video-section');\r\nconst startBtn = document.getElementById('start-btn');\r\nconst stopBtn = document.getElementById('stop-btn');\r\nconst resetBtn = document.getElementById('reset-btn');\r\nconst roomInput = document.getElementById('room-input');\r\nconst roomDisplay = document.getElementById('room-display');\r\nconst userDisplay = document.getElementById('user-display');\r\nconst localTimeEl = document.getElementById('local-time');\r\nconst syncStatusEl = document.getElementById('sync-status');\r\nconst remoteUsersList = document.getElementById('remote-users-list');\r\nconst localVideo = document.getElementById('local-video');\r\nconst remoteVideo = document.getElementById('remote-video');\r\nconst copyRoomBtn = document.getElementById('copy-room-btn');\r\n\r\nupdateStatus();\r\nsetupEventListeners();\r\nstartStatusPolling();\r\n\r\nfunction setupEventListeners() {\r\n  startBtn.addEventListener('click', startParty);\r\n  stopBtn.addEventListener('click', stopParty);\r\n  resetBtn.addEventListener('click', resetParty);\r\n  copyRoomBtn.addEventListener('click', copyRoomId);\r\n}\r\n\r\nfunction updateStatus() {\r\n  chrome.runtime.sendMessage({ type: 'GET_STATUS' }, (response) => {\r\n    if (chrome.runtime.lastError) return;\r\n    if (response) {\r\n      status = response;\r\n      updateUI();\r\n    }\r\n  });\r\n}\r\n\r\nfunction updateUI() {\r\n  const { isConnected, roomId, userId } = status;\r\n  if (isConnected) {\r\n    statusEl.className = 'status connected';\r\n    statusText.textContent = 'üü¢ Connected';\r\n    controlsSection.classList.remove('hidden');\r\n    startBtn.classList.add('hidden');\r\n    stopBtn.classList.remove('hidden');\r\n    resetBtn.classList.remove('hidden');\r\n    partyInfo.classList.remove('hidden');\r\n    statsSection.classList.remove('hidden');\r\n    roomDisplay.textContent = roomId;\r\n    userDisplay.textContent = userId;\r\n    updateStats();\r\n  } else {\r\n    statusEl.className = 'status disconnected';\r\n    statusText.textContent = 'üî¥ Disconnected';\r\n    controlsSection.classList.remove('hidden');\r\n    startBtn.classList.remove('hidden');\r\n    stopBtn.classList.add('hidden');\r\n    resetBtn.classList.add('hidden');\r\n    partyInfo.classList.add('hidden');\r\n    statsSection.classList.add('hidden');\r\n    videoSection.classList.add('hidden');\r\n    localVideo.srcObject = null;\r\n    remoteVideo.srcObject = null;\r\n  }\r\n}\r\n\r\nasync function startParty() {\r\n  const roomId = roomInput.value.trim() || undefined;\r\n  startBtn.disabled = true;\r\n  statusText.textContent = '‚è≥ Connecting...';\r\n  chrome.runtime.sendMessage({ type: 'START_PARTY', roomId }, (response) => {\r\n    if (response.success) {\r\n      setTimeout(updateStatus, 500);\r\n    } else {\r\n      alert('Error: ' + response.error);\r\n      statusText.textContent = 'üî¥ Disconnected';\r\n      startBtn.disabled = false;\r\n    }\r\n  });\r\n}\r\n\r\nfunction stopParty() {\r\n  chrome.runtime.sendMessage({ type: 'STOP_PARTY' }, () => {\r\n    roomInput.value = '';\r\n    updateStatus();\r\n  });\r\n}\r\n\r\nfunction resetParty() {\r\n  const desiredRoomId = roomInput.value.trim() || status.roomId || undefined;\r\n  resetBtn.disabled = true;\r\n  statusText.textContent = '‚ôªÔ∏è Resetting...';\r\n  chrome.runtime.sendMessage({ type: 'STOP_PARTY' }, () => {\r\n    chrome.runtime.sendMessage({ type: 'START_PARTY', roomId: desiredRoomId }, (response) => {\r\n      resetBtn.disabled = false;\r\n      if (response && response.success) {\r\n        setTimeout(updateStatus, 500);\r\n      } else {\r\n        alert('Error resetting party: ' + (response && response.error ? response.error : 'Unknown error'));\r\n        statusText.textContent = 'üî¥ Disconnected';\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\nfunction copyRoomId() {\r\n  if (status.roomId) {\r\n    navigator.clipboard.writeText(status.roomId);\r\n    copyRoomBtn.textContent = '‚úì';\r\n    setTimeout(() => { copyRoomBtn.textContent = 'üìã'; }, 2000);\r\n  }\r\n}\r\n\r\nfunction startStatusPolling() {\r\n  updateStatus();\r\n  setInterval(updateStatus, 2000);\r\n  // Update stats more frequently when connected\r\n  setInterval(() => {\r\n    if (status.isConnected) {\r\n      updateStats();\r\n    }\r\n  }, 1000);\r\n}\r\n\r\nasync function updateStats() {\r\n  if (!status.isConnected || !status.roomId) {\r\n    console.log('[Popup] Not connected or no room ID');\r\n    return;\r\n  }\r\n\r\n  try {\r\n    // Fetch stats from signaling server\r\n    const response = await fetch('http://watch.toper.dev/status');\r\n    if (!response.ok) {\r\n      console.error('[Popup] Failed to fetch server status');\r\n      return;\r\n    }\r\n\r\n    const serverStatus = await response.json();\r\n    console.log('[Popup] Server status:', serverStatus);\r\n\r\n    // Find our room\r\n    const room = serverStatus.rooms?.find(r => r.roomId === status.roomId);\r\n    if (!room) {\r\n      console.log('[Popup] Room not found on server');\r\n      if (syncStatusEl) {\r\n        syncStatusEl.textContent = 'Not Found';\r\n        syncStatusEl.style.color = '#ef4444';\r\n      }\r\n      return;\r\n    }\r\n\r\n    const formatTime = (seconds) => {\r\n      if (!seconds && seconds !== 0) return '--:--';\r\n      const totalSeconds = Math.floor(seconds);\r\n      const minutes = Math.floor(totalSeconds / 60);\r\n      const secs = totalSeconds % 60;\r\n      return `${minutes}:${secs.toString().padStart(2, '0')}`;\r\n    };\r\n\r\n    // Update local time (use room's currentTime as reference)\r\n    if (localTimeEl) {\r\n      localTimeEl.textContent = formatTime(room.currentTime);\r\n    }\r\n\r\n    // Update sync status\r\n    if (syncStatusEl) {\r\n      const isPlaying = room.isPlaying ? 'Playing' : 'Paused';\r\n      syncStatusEl.textContent = isPlaying;\r\n      syncStatusEl.style.color = room.isPlaying ? '#4ade80' : '#fbbf24';\r\n    }\r\n\r\n    // Update user list with individual positions\r\n    if (remoteUsersList) {\r\n      const users = room.users || [];\r\n      \r\n      if (users.length === 0) {\r\n        remoteUsersList.innerHTML = '<div style=\"color: rgba(255,255,255,0.5); font-size: 12px; font-style: italic;\">No users in party</div>';\r\n      } else {\r\n        const userListHTML = users.map((user, index) => {\r\n          const timeDiff = Math.abs(user.currentTime - room.currentTime);\r\n          const isOutOfSync = timeDiff > 2; // More than 2 seconds off\r\n          const statusColor = user.isPlaying ? '#4ade80' : '#fbbf24';\r\n          const syncColor = isOutOfSync ? '#ef4444' : '#4ade80';\r\n          \r\n          return `\r\n            <div style=\"padding: 8px; border-top: 1px solid rgba(255,255,255,0.1); ${index === 0 ? 'border-top: none;' : ''}\">\r\n              <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;\">\r\n                <div style=\"font-weight: 600; font-size: 12px; color: rgba(255,255,255,0.9);\">\r\n                  ${user.userId.substring(0, 8)}...\r\n                </div>\r\n                <div style=\"font-size: 10px; color: ${statusColor};\">\r\n                  ${user.isPlaying ? '‚ñ∂' : '‚è∏'}\r\n                </div>\r\n              </div>\r\n              <div style=\"display: flex; justify-content: space-between; align-items: center;\">\r\n                <div style=\"font-size: 13px; font-weight: 600; color: #a78bfa;\">\r\n                  ${formatTime(user.currentTime)}\r\n                </div>\r\n                <div style=\"font-size: 10px; color: ${syncColor}; font-weight: 600;\">\r\n                  ${isOutOfSync ? `¬±${timeDiff.toFixed(1)}s` : '‚úì synced'}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          `;\r\n        }).join('');\r\n        \r\n        remoteUsersList.innerHTML = `\r\n          <div style=\"font-weight: 600; font-size: 12px; margin-bottom: 8px; color: rgba(255,255,255,0.7);\">\r\n            ${users.length} user${users.length === 1 ? '' : 's'} in party\r\n          </div>\r\n          ${userListHTML}\r\n        `;\r\n      }\r\n    }\r\n  } catch (error) {\r\n    console.error('[Popup] Error fetching stats:', error);\r\n  }\r\n}\r\n\r\nchrome.runtime.onMessage.addListener((request) => {\r\n  if (request.type === 'REMOTE_STREAM_RECEIVED') {\r\n    remoteVideo.srcObject = request.stream;\r\n  }\r\n});\r\n"],"names":["status","isConnected","roomId","userId","hasLocalStream","statusEl","document","getElementById","statusText","controlsSection","partyInfo","statsSection","videoSection","startBtn","stopBtn","resetBtn","roomInput","roomDisplay","userDisplay","localTimeEl","syncStatusEl","remoteUsersList","localVideo","remoteVideo","copyRoomBtn","updateStatus","chrome","runtime","sendMessage","type","response","lastError","className","textContent","classList","remove","add","updateStats","srcObject","updateUI","async","fetch","ok","console","error","serverStatus","json","log","room","rooms","find","r","style","color","formatTime","seconds","totalSeconds","Math","floor","toString","padStart","currentTime","isPlaying","users","length","innerHTML","userListHTML","map","user","index","timeDiff","abs","isOutOfSync","statusColor","syncColor","substring","toFixed","join","addEventListener","value","trim","undefined","disabled","success","setTimeout","alert","desiredRoomId","navigator","clipboard","writeText","setInterval","onMessage","addListener","request","stream"],"ignoreList":[],"sourceRoot":""}